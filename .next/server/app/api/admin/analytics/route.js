"use strict";(()=>{var e={};e.id=7777,e.ids=[7777],e.modules={49262:e=>{e.exports=require("@prisma/client/runtime/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},21656:e=>{e.exports=import("@prisma/client/runtime/query_compiler_fast_bg.postgresql.mjs")},30245:e=>{e.exports=import("@prisma/client/runtime/query_compiler_fast_bg.postgresql.wasm-base64.mjs")},72254:e=>{e.exports=require("node:buffer")},49411:e=>{e.exports=require("node:path")},41041:e=>{e.exports=require("node:url")},96842:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>g,patchFetch:()=>w,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m});var r={};a.r(r),a.d(r,{GET:()=>u});var s=a(73278),n=a(45002),o=a(54877),i=a(71309),l=a(86536),p=a(82208);async function u(){let e=await (0,l.I8)();if(!e?.user?.id||"ADMIN"!==e.user.role)return i.NextResponse.json({error:"Unauthorized"},{status:401});let t=new Date;t.setMonth(t.getMonth()-6);let a=await p._.invoice.findMany({where:{status:"PAID",paidAt:{gte:t}},select:{amount:!0,paidAt:!0}}),r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],s={};for(let e=5;e>=0;e--){let t=new Date;t.setMonth(t.getMonth()-e),s[`${r[t.getMonth()]} ${t.getFullYear()}`]=0}a.forEach(e=>{if(e.paidAt){let t=`${r[e.paidAt.getMonth()]} ${e.paidAt.getFullYear()}`;t in s&&(s[t]+=e.amount)}});let n=Object.entries(s).map(([e,t])=>({name:e,revenue:t})),o=new Date;o.setDate(o.getDate()-28);let u=await p._.shipment.findMany({where:{createdAt:{gte:o}},select:{status:!0,createdAt:!0}}),d=[];for(let e=3;e>=0;e--){let t=new Date;t.setDate(t.getDate()-(e+1)*7);let a=new Date;a.setDate(a.getDate()-7*e);let r=u.filter(e=>e.createdAt>=t&&e.createdAt<a);d.push({name:`Week ${4-e}`,shipments:r.length,completed:r.filter(e=>"DELIVERED"===e.status).length})}let c=(await p._.shipment.groupBy({by:["status"],_count:!0})).map(e=>({name:e.status.replace(/_/g," "),value:e._count})),m=await p._.order.findMany({where:{createdAt:{gte:t}},select:{status:!0,createdAt:!0}}),h={};for(let e=5;e>=0;e--){let t=new Date;t.setMonth(t.getMonth()-e),h[`${r[t.getMonth()]}`]={orders:0,completed:0}}m.forEach(e=>{let t=r[e.createdAt.getMonth()];t in h&&(h[t].orders++,"COMPLETED"===e.status&&h[t].completed++)});let g=Object.entries(h).map(([e,t])=>({name:e,...t})),[w,A,x,f]=await Promise.all([p._.invoice.aggregate({where:{status:"PAID"},_sum:{amount:!0}}),p._.shipment.count(),p._.order.count(),p._.user.count({where:{role:"OPERATOR"}})]);return i.NextResponse.json({stats:{totalRevenue:w._sum.amount||0,totalShipments:A,totalOrders:x,activeOperators:f},revenueData:n,throughputData:d,statusData:c,orderTrendsData:g})}let d=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/admin/analytics/route",pathname:"/api/admin/analytics",filename:"route",bundlePath:"app/api/admin/analytics/route"},resolvedPagePath:"/Users/macbook/Desktop/24:7Onboarding/247-fba-platform/src/app/api/admin/analytics/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:c,staticGenerationAsyncStorage:m,serverHooks:h}=d,g="/api/admin/analytics/route";function w(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},86536:(e,t,a)=>{a.d(t,{I8:()=>u,handlers:()=>p});var r=a(19036),s=a(25001),n=a(32730),o=a(93981),i=a(82208);let l={pages:{signIn:"/login"},callbacks:{authorized({auth:e,request:{nextUrl:t}}){let a=!!e?.user,r=t.pathname.startsWith("/portal"),s=t.pathname.startsWith("/admin"),n=t.pathname.startsWith("/ops"),o=t.pathname.startsWith("/login")||t.pathname.startsWith("/register")||t.pathname.startsWith("/forgot-password"),i=e?.user?.role;return r||s||n?!!a&&(s&&"ADMIN"!==i?Response.redirect(new URL("OPERATOR"===i?"/ops":"/portal",t)):n&&"OPERATOR"!==i&&"ADMIN"!==i?Response.redirect(new URL("/portal",t)):!r||"OPERATOR"!==i||Response.redirect(new URL("/ops",t))):!o||!a||Response.redirect(new URL("ADMIN"===i?"/admin":"OPERATOR"===i?"/ops":"/portal",t))}},providers:[]},{handlers:p,auth:u,signIn:d,signOut:c}=(0,r.ZP)({...l,adapter:(0,n.N)(i._),session:{strategy:"jwt"},providers:[(0,s.Z)({credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await i._.user.findUnique({where:{email:e.email}});return t&&t.password&&await o.ZP.compare(e.password,t.password)?{id:t.id,email:t.email,name:t.name,role:t.role,image:t.image}:null}})],callbacks:{...l.callbacks,jwt:async({token:e,user:t})=>(t&&(e.id=t.id,e.role=t.role),e),session:async({session:e,token:t})=>(t&&(e.user.id=t.id,e.user.role=t.role),e)}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[9379,4833,2135,97,2208],()=>a(96842));module.exports=r})();